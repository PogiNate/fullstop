#!/usr/bin/env ruby -w

require 'fileutils'
require 'optparse'

include FileUtils

options = {
  :checkout => File.expand_path("~"),
}
option_parser = OptionParser.new do |opts|
  opts.on("--checkout DIR") do |dir|
    options[:checkout] = File.expand_path(dir)
  end
end

option_parser.parse!

source = ARGV.shift
destination = ARGV.shift

checkout_dir = options[:checkout]

mkdir_p checkout_dir
chdir checkout_dir
%x[git clone #{source} dotfiles]

mkdir_p destination
chdir destination

Dir["#{checkout_dir}/dotfiles/.*"].each do |file|
  next if ['.','..'].include?(File.split(file)[-1])
  ln file,'.'
end
